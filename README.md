# ğŸš€ å¾®ä¿¡å°ç¨‹åº Â· é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°é€šç”¨æ¨¡æ¿

> å‘Šåˆ«é‡å¤é€ è½®å­ï¼Œä¸€é”®æ¥å…¥é˜¿é‡Œäº‘ï¼Œè®©æ‚¨çš„ç‰©è”ç½‘åˆ›æ„å¿«é€Ÿè½åœ°ï¼

### ğŸ™ ç‰¹åˆ«é¸£è°¢

æœ¬æ–‡çš„ä»£ç åŸºäºBç«™UPä¸»æ ˆå°æ»¡_XMPçš„æ•™ç¨‹ **ã€Šæ¯•è®¾ï¼šSTM32+ESP8266-01S+é˜¿é‡Œäº‘+å¾®ä¿¡å°ç¨‹åº å®ç°æ™ºèƒ½å®¶å±…ã€‹** æ‹“å±•ï¼Œå‘ˆä¸Šæ ˆå°æ»¡_XMPè€å¸ˆçš„è§†é¢‘æ•™ç¨‹ï¼š[ç‚¹å‡»è§‚çœ‹æ•™ç¨‹](https://www.bilibili.com/video/BV1aw411y7Kp/?spm_id_from=333.337.search-card.all.click&vd_source=495d4c74bf598b3a22917e898f335430)

---

### ğŸ“– ç®€ä»‹

åœ¨åµŒå…¥å¼å¼€å‘çš„å­¦ä¹ ä¸å®è·µä¸­ï¼Œæ¯å½“ä½¿ç”¨WiFiæˆ–4Gæ¨¡å—æ—¶ï¼Œå¾€å¾€ç¦»ä¸å¼€äº‘å¹³å°çš„æ”¯æŒã€‚ç„¶è€Œï¼Œå•çº¯çš„ç¡¬ä»¶ä¸Šäº‘åªæ˜¯ç¬¬ä¸€æ­¥ï¼ŒçœŸæ­£è®©é¡¹ç›® **â€œå¥½ç©â€** èµ·æ¥çš„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªèƒ½å®æ—¶äº¤äº’çš„ä¸Šä½æœºã€‚ **å¾®ä¿¡å°ç¨‹åº** å› å…¶ä¸Šæ‰‹éš¾åº¦ä½ã€å¼€å‘æ•ˆç‡é«˜ï¼Œæˆä¸ºäº†ä¸é”™çš„ä¸Šä½æœºæ–¹æ¡ˆã€‚ä½†æ¯æ¬¡éƒ½è¦é‡å¤ç¼–å†™å°ç¨‹åºè¿æ¥é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°çš„ä»£ç ï¼Œä¸ä»…ç¹çä¸”æ•ˆç‡ä½ä¸‹ã€‚

ç§‰æŒ **ä¸é‡å¤é€ è½®å­** çš„å®—æ—¨ï¼Œæˆ‘ä»ä¸Šä¸€ä¸ªé¡¹ç›®å†™çš„å°ç¨‹åºä¸­æ•´ç†ã€ç²¾ç®€å‡ºè¿™å¥— **å¯è½»æ¾ç§»æ¤çš„é€šç”¨æ¨¡æ¿ç¨‹åº**ã€‚å®ƒå°è£…äº†å°ç¨‹åºä¸é˜¿é‡Œäº‘ä¹‹é—´çš„æ ¸å¿ƒé€šä¿¡é€»è¾‘ï¼Œå¦‚MQTTè¿æ¥ã€æ¶ˆæ¯è®¢é˜…/å‘å¸ƒã€ç¦»çº¿æ¶ˆæ¯å¤„ç†ç­‰åŠŸèƒ½ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…ä»é‡å¤çš„åŸºç¡€å·¥ä½œä¸­è§£æ”¾å‡ºæ¥ï¼Œåªéœ€ç®€å•é…ç½®ï¼Œå³å¯å¿«é€Ÿæ­å»ºå±äºè‡ªå·±çš„ç‰©è”ç½‘åº”ç”¨ï¼Œ**è®©åˆ›æ„æ›´å¿«è½åœ°ï¼** âœ¨

---

### â­ æœ¬é¡¹ç›®äº®ç‚¹

|        | äº®ç‚¹                   | æè¿°                                                         |
| :----: | :--------------------- | :----------------------------------------------------------- |
| **01** | ğŸ¯ **ç»Ÿä¸€é…ç½®ç®¡ç†**     | æ‰€æœ‰é…ç½®é›†ä¸­åœ¨ `config.js`ï¼Œä¸€æ¬¡é…ç½®å…¨å±€ç”Ÿæ•ˆï¼Œç§»æ¤åªéœ€ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ |
| **02** | ğŸ“¡ **å…¨å±€æ¶ˆæ¯è®¢é˜…ç³»ç»Ÿ** | å®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œæ”¯æŒå¤šé¡µé¢åŒæ—¶æ¥æ”¶æ¶ˆæ¯ï¼Œè‡ªåŠ¨ç®¡ç†è®¢é˜…ç”Ÿå‘½å‘¨æœŸ |
| **03** | ğŸ’¾ **ç¦»çº¿æ¶ˆæ¯å¤„ç†**     | è‡ªåŠ¨ä¿å­˜ç¦»çº¿æœŸé—´æ¶ˆæ¯ï¼Œé¡µé¢é‡æ–°åŠ è½½æ—¶è‡ªåŠ¨æ¢å¤ï¼Œ**ä¸ä¸¢å¤±ä»»ä½•æ¶ˆæ¯** |
| **04** | ğŸ§  **æ™ºèƒ½æ¶ˆæ¯è§£æ**     | æ”¯æŒå¤šç§æ¶ˆæ¯æ ¼å¼è‡ªåŠ¨è¯†åˆ«ï¼ˆç³»ç»Ÿæ¶ˆæ¯ã€ä¸šåŠ¡æ¶ˆæ¯ã€å®šä½ä¿¡æ¯ç­‰ï¼‰ï¼Œå¯æ‰©å±•çš„æ¶ˆæ¯ç±»å‹æ˜ å°„ |
| **05** | ğŸ”— **è¿æ¥çŠ¶æ€æŒä¹…åŒ–**   | æµ‹è¯•çŠ¶æ€åœ¨é¡µé¢åˆ‡æ¢å’Œåå°è¿è¡Œæ—¶è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤ï¼Œç”¨æˆ·ä½“éªŒæµç•…   |
| **06** | ğŸ”„ **è‡ªåŠ¨é‡è¿æœºåˆ¶**     | MQTTå®¢æˆ·ç«¯æ”¯æŒè‡ªåŠ¨é‡è¿ï¼Œç½‘ç»œæ¢å¤åè‡ªåŠ¨é‡æ–°è¿æ¥å’Œè®¢é˜…         |
| **07** | ğŸ“¶ **ç½‘ç»œçŠ¶æ€æ£€æµ‹**     | è¿æ¥å‰è‡ªåŠ¨æ£€æµ‹ç½‘ç»œçŠ¶æ€ï¼Œæä¾›å‹å¥½çš„é”™è¯¯æç¤º                   |
| **08** | ğŸ“¦ **æ¶ˆæ¯æ•°é‡é™åˆ¶**     | è‡ªåŠ¨é™åˆ¶æ¶ˆæ¯åˆ—è¡¨æ•°é‡ï¼ˆ200æ¡ï¼‰ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºï¼Œä¿æŒåº”ç”¨æ€§èƒ½    |

---

### ğŸ“ é¡¹ç›®æ ¸å¿ƒæ–‡ä»¶ç›®å½•æ ‘

```
TempleWXAppForIOT/
â”œâ”€â”€ ğŸ› ï¸ .idea/                   # IDEé…ç½®æ–‡ä»¶å¤¹ï¼ˆå¯å¿½ç•¥ï¼‰
â”œâ”€â”€ ğŸ¨ icon/                     # å›¾æ ‡èµ„æºç›®å½•
â”‚   â”œâ”€â”€ connect_black.png        # è¿æ¥å›¾æ ‡ï¼ˆæœªé€‰ä¸­ï¼‰
â”‚   â”œâ”€â”€ connect_blue.png         # è¿æ¥å›¾æ ‡ï¼ˆå·²é€‰ä¸­ï¼‰
â”‚   â”œâ”€â”€ message_black.png        # æ¶ˆæ¯å›¾æ ‡ï¼ˆæœªé€‰ä¸­ï¼‰
â”‚   â””â”€â”€ message_blue.png         # æ¶ˆæ¯å›¾æ ‡ï¼ˆå·²é€‰ä¸­ï¼‰
â”œâ”€â”€ ğŸ“± pages/                     # é¡µé¢æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ index/                    # è¿æ¥æµ‹è¯•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index.js              # é¡µé¢é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ index.json            # é¡µé¢é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.wxml            # é¡µé¢ç»“æ„
â”‚   â”‚   â””â”€â”€ index.wxss            # é¡µé¢æ ·å¼
â”‚   â”œâ”€â”€ login/                    # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ login.js              # é¡µé¢é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ login.json            # é¡µé¢é…ç½®
â”‚   â”‚   â”œâ”€â”€ login.wxml            # é¡µé¢ç»“æ„
â”‚   â”‚   â””â”€â”€ login.wxss            # é¡µé¢æ ·å¼
â”‚   â””â”€â”€ message/                  # æ¶ˆæ¯æ¥æ”¶é¡µé¢
â”‚       â”œâ”€â”€ message.js            # é¡µé¢é€»è¾‘
â”‚       â”œâ”€â”€ message.json          # é¡µé¢é…ç½®
â”‚       â”œâ”€â”€ message.wxml          # é¡µé¢ç»“æ„
â”‚       â””â”€â”€ message.wxss          # é¡µé¢æ ·å¼
â”œâ”€â”€ ğŸ› ï¸ utils/                      # å·¥å…·ç±»ç›®å½•
â”‚   â”œâ”€â”€ aliyun/                   # é˜¿é‡Œäº‘ç›¸å…³å·¥å…·
â”‚   â”‚   â”œâ”€â”€ aliyun_connect.js     # é˜¿é‡Œäº‘è¿æ¥å‚æ•°ç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ hex_hmac_sha1.js      # HMAC-SHA1åŠ å¯†ç®—æ³•
â”‚   â”œâ”€â”€ mqtt.js                    # MQTTå®¢æˆ·ç«¯åº“
â”‚   â””â”€â”€ util.js                    # é€šç”¨å·¥å…·å‡½æ•°
â”œâ”€â”€ ğŸ§© app.js                       # å°ç¨‹åºä¸»å…¥å£
â”œâ”€â”€ âš™ï¸ app.json                     # å°ç¨‹åºå…¨å±€é…ç½®
â”œâ”€â”€ ğŸ¨ app.wxss                     # å…¨å±€æ ·å¼
â”œâ”€â”€ ğŸ”‘ config.js                    # ã€ç»Ÿä¸€é…ç½®æ–‡ä»¶-å¿…æ”¹ã€‘
â”œâ”€â”€ âš™ï¸ project.config.json          # å…¬å…±æ ‡å‡†é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ”’ project.private.config.json  # ç§æœ‰é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ—ºï¸ sitemap.json                 # ç«™ç‚¹åœ°å›¾é…ç½®
â””â”€â”€ ğŸ‘ï¸ .gitignore                   # Gitå¿½ç•¥æ–‡ä»¶
```

---

## ğŸ“¦ ç§»æ¤è¯´æ˜

### 01 ç¯å¢ƒå‡†å¤‡ ğŸŒ±

ä¸‹è½½å¹¶å®‰è£… [å¾®ä¿¡å¼€å‘è€…å·¥å…·](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)ï¼Œå»ºè®®ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬ã€‚

### 02 é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å‡†å¤‡å’Œä»£ç å¿…æ”¹éƒ¨åˆ† ğŸ”‘

1. æ³¨å†Œé˜¿é‡Œäº‘è´¦å·å¹¶å¼€é€šç‰©è”ç½‘å¹³å°æœåŠ¡ã€‚
2. åˆ›å»ºä¸€ä¸ªäº§å“å¹¶åœ¨äº§å“ä¸‹åˆ›å»ºä¸€ä¸ªè®¾å¤‡ï¼Œè®°å½• **é˜¿é‡Œäº‘ä¸‰å…ƒç»„** ç­‰ä¿¡æ¯ã€‚

> ğŸ“º **å…³äºé˜¿é‡Œäº‘çš„æ“ä½œ**ï¼šå¯ä»¥å‚è€ƒBç«™UPä¸»æ ˆå°æ»¡_XMPè€å¸ˆçš„è§†é¢‘æ•™ç¨‹  
> [ç‚¹å‡»è§‚çœ‹](https://www.bilibili.com/video/BV1nZ4y1n7dE/?spm_id_from=333.1387.homepage.video_card.click&vd_source=495d4c74bf598b3a22917e898f335430)

åœ¨æœ¬æ¨¡æ¿ä¸­ï¼Œé˜¿é‡Œäº‘é…ç½®æ–‡ä»¶å·²å•ç‹¬å°è£…åˆ° `config.js` æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨æ—¶ä»…éœ€ä¿®æ”¹æ­¤å¤„ä¿¡æ¯ï¼š

```javascript
const config = {
  // é˜¿é‡Œäº‘é…ç½®ï¼šè¯·ç™»å½•é˜¿é‡Œäº‘å¹³å°æŸ¥çœ‹å¹¶åœ¨ä¸‹æ–¹è¡¥å…¨
  aliyun: {
    productKey: 'å¡«å†™ä½ çš„äº§å“å¯†é’¥',      // äº§å“å”¯ä¸€æ ‡è¯†ï¼ˆåœ¨"äº§å“è¯¦æƒ…"é¡µæŸ¥çœ‹ï¼‰
    deviceName: 'å¡«å†™ä½ çš„è®¾å¤‡åç§°',       // è®¾å¤‡åç§°ï¼ˆåœ¨"è®¾å¤‡åˆ—è¡¨"ä¸­æŸ¥çœ‹ï¼‰
    deviceSecret: 'å¡«å†™ä½ çš„è®¾å¤‡å¯†é’¥',      // è®¾å¤‡å¯†é’¥ï¼ˆåˆ›å»ºè®¾å¤‡æ—¶ç”Ÿæˆï¼Œè¯·å¦¥å–„ä¿ç®¡ï¼‰
    regionId: 'å¡«å†™æœåŠ¡åœ°åŸŸID',           // æœåŠ¡åœ°åŸŸï¼ˆé€šå¸¸å¯ä»¥ç”¨cn-shanghaiç­‰ï¼‰
    pubTopic: 'å¡«å†™å‘å¸ƒæ¶ˆæ¯çš„ä¸»é¢˜',        // å°ç¨‹åºå‘å¸ƒæ¶ˆæ¯ç»™è®¾å¤‡çš„Topic
    subTopic: 'å¡«å†™è®¢é˜…æ¶ˆæ¯çš„ä¸»é¢˜',        // å°ç¨‹åºæ¥æ”¶è®¾å¤‡æ¶ˆæ¯çš„Topic
  },
```

> ğŸ’¡ **ä¸æ ˆå°æ»¡è€å¸ˆåŸæ•™ç¨‹çš„åŒºåˆ«**  
> è€å¸ˆæåˆ°çš„ **åˆæ¬¡è®¢é˜…ä½¿ç”¨çš„ä»£ç ç‰‡æ®µ**ï¼Œæœ¬æ¨¡æ¿å·²å°†å…¶å°è£…åˆ° `app.js` æ–‡ä»¶ä¸­çš„ `initMQTT()` å‡½æ•°ã€‚æ‚¨æ— éœ€å¦‚è€å¸ˆçš„æ•™ç¨‹ä»£ç é‚£æ ·ä½¿ç”¨ä¸€æ¬¡åæ³¨é‡Šæ‰è¿™éƒ¨åˆ†ä»£ç ï¼Œå› ä¸ºæœ¬æ¨¡æ¿å·²ä¼˜åŒ–äº†è®¢é˜…æœºåˆ¶ï¼š**MQTTè¿æ¥ä»…åœ¨åˆå§‹åŒ–æ—¶è®¢é˜…ä¸€æ¬¡**ï¼Œæ‰€æœ‰é¡µé¢é€šè¿‡æ¶ˆæ¯å¹¿æ’­ç³»ç»Ÿå…±äº«åŒä¸€ä¸ªè®¢é˜…ï¼Œæ— éœ€é‡å¤è®¢é˜…ï¼Œä¹Ÿä¸ä¼šé€ æˆèµ„æºæµªè´¹ã€‚

---

### 03 å°ç¨‹åºé¡¹ç›®å¯¼å…¥ ğŸ“²

å®Œæˆ01å’Œ02ä¸¤ä¸ªæ­¥éª¤åï¼Œæ‚¨å¯ä»¥å°†æœ¬é¡¹ç›®å¯¼å…¥åˆ°æ‚¨çš„å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ã€‚

åœ¨å¯¼å…¥é¡¹ç›®åæ‚¨åœ¨ç¼–è¯‘è¿è¡Œæ—¶å¯èƒ½é‡åˆ°æŠ¥é”™

```
wss://æ‚¨çš„äº§å“â€¦â€¦ ä¸åœ¨ä»¥ä¸‹ socket åˆæ³•åŸŸååˆ—è¡¨ä¸­ï¼Œè¯·é…ç½®åŸŸå...
```

è¿™æ˜¯ç¬”è€…ä¹‹å‰é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå¤§è‡´æ˜¯è¯´å°ç¨‹åºæ­£åœ¨å°è¯•è¿æ¥é˜¿é‡Œäº‘MQTTçš„WebSocketåœ°å€ï¼ˆ `ws://...` ï¼‰ï¼Œä½†è¿™ä¸ªåŸŸåæ²¡æœ‰é…ç½®åœ¨å°ç¨‹åºçš„ **â€œsocketåˆæ³•åŸŸåâ€** ä¸­ã€‚

**è§£å†³æ–¹æ³•ï¼š**

1. ç‚¹å‡» **â€œè¯¦æƒ…â€**ï¼Œå¤åˆ¶è¿™ä¸ªsocketåˆæ³•åŸŸå

![image-20260215212546650](README.assets/image-20260215212546650.png)

2. ç™»å½• [å°ç¨‹åºåå°](https://mp.weixin.qq.com/)ï¼Œä½¿ç”¨æ‚¨çš„è´¦å·ç™»å½•
3. è¿›å…¥ **â€œå¼€å‘â€ â†’ â€œå¼€å‘ç®¡ç†â€ â†’ â€œå¼€å‘è®¾ç½®â€**
4. åœ¨ **â€œæœåŠ¡å™¨åŸŸåâ€** æ¿å—ä¸­ï¼Œæ‰¾åˆ° **â€œsocketåˆæ³•åŸŸåâ€** ä¸€é¡¹
5. ç‚¹å‡» **â€œä¿®æ”¹â€** æŒ‰é’®ï¼Œå°†æ‚¨çš„ WebSocket åŸŸåæ·»åŠ è¿›å»
6. å›åˆ°å°ç¨‹åºé‡æ–°ç¼–è¯‘å³å¯

![é…ç½®åˆæ³•åŸŸå](README.assets/image-20260214230441291.png)

---

### 04 ç›´æ¥è¿è¡Œç¨‹åº â–¶ï¸

æˆåŠŸç¼–è¯‘è¿è¡Œåæ‚¨ä¼šé¦–å…ˆçœ‹åˆ°å°ç¨‹åºçš„ **ç™»å½•ç•Œé¢**ï¼Œå½“å‰å°ç¨‹åºçš„ç™»å½•ç•Œé¢æš‚æœªè®¾å®šç”¨æˆ·åå’Œå¯†ç ç»‘å®šå’ŒéªŒè¯é€»è¾‘ï¼Œæ‚¨å¯ä»¥ç›´æ¥ç‚¹å‡»ç™»å½•æŒ‰é’®è¿›å…¥å°ç¨‹åºã€‚å¦‚æœæ‚¨éœ€è¦ç™»å½•éªŒè¯ç­‰åŠŸèƒ½ï¼Œå¯ä»¥è‡ªè¡Œå¼€å‘åç«¯é€»è¾‘å®ç°ä¸å°ç¨‹åºé…åˆä½¿ç”¨ã€‚

![ç™»å½•ç•Œé¢](README.assets/image-20260214222742663.png)

ç™»å½•æˆåŠŸåï¼Œæ‚¨å°†è‡ªåŠ¨è¿›å…¥ **äº‘å¹³å°è¿æ¥æµ‹è¯•é¡µ**ã€‚

åœ¨æ­¤é¡µé¢ç‚¹å‡» **â€œè¿è¡Œé€šä¿¡æµ‹è¯•â€** æŒ‰é’®ï¼Œå°ç¨‹åºä¼šä¸»åŠ¨å‘é˜¿é‡Œäº‘å‘é€ä¸€æ¡ `{"status": "connecttest"}` çš„æµ‹è¯•æ¶ˆæ¯ã€‚æµ‹è¯•é˜¶æ®µæ‚¨éœ€è¦åœ¨ç•Œé¢çš„30ç§’å€’è®¡æ—¶å†…é€šè¿‡é˜¿é‡Œäº‘ç‰©è”ç½‘æ§åˆ¶å°å‘å°ç¨‹åºå‘é€ `{"status": "connecttestok"}` æ¶ˆæ¯ã€‚

> âœï¸ **ç‰¹åˆ«è¯´æ˜**ï¼šæ‚¨åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°å‘é€çš„å›å¤æ¶ˆæ¯ï¼Œå®é™…ä¸Šæ˜¯æ¨¡æ‹Ÿ**ç‰©è”ç½‘è®¾å¤‡ç«¯**å‘å°ç¨‹åºä¸‹å‘æ¶ˆæ¯çš„è¿‡ç¨‹ã€‚å¦‚æœåç»­æ‚¨åœ¨äº§å“ä¸‹åˆ›å»ºäº†å¤šä¸ªè®¾å¤‡ï¼Œè¿˜å¯ä»¥é€šè¿‡é…ç½®å‘å¸ƒ/è®¢é˜…ä¸»é¢˜ï¼Œå®ç°è®¾å¤‡ä¸å°ç¨‹åºä¹‹é—´çš„åŒå‘é€šä¿¡ï¼Œæ–¹ä¾¿è¿›è¡Œæ›´ä¸°å¯Œçš„åŠŸèƒ½æµ‹è¯•å’Œå¼€å‘ã€‚

**é€šè¿‡é˜¿é‡Œäº‘å‘å°ç¨‹åºå‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼š**

| æ­¥éª¤ | æ“ä½œ                          |
| :--: | :---------------------------- |
|  â‘    | è¿›å…¥ç‰©è”ç½‘å¹³å°æ§åˆ¶å°          |
|  â‘¡   | é€‰æ‹©æ‚¨çš„äº§å“ï¼Œç‚¹å‡»â€œTopicåˆ—è¡¨â€ |
|  â‘¢   | é€‰æ‹©è®¢é˜…ä¸»é¢˜ï¼Œç‚¹å‡»â€œå‘å¸ƒæ¶ˆæ¯â€  |

![image-20260215212800539](README.assets/image-20260215212800539.png)
![image-20260215212922099](README.assets/image-20260215212922099.png)

![image-20260215213028040](README.assets/image-20260215213028040.png)

ç‚¹å‡»ç¡®è®¤åå›åˆ°å°ç¨‹åºï¼Œæ‚¨ä¼šçœ‹åˆ° **â€œè®¾å¤‡è¿æ¥æ­£å¸¸â€** çš„æˆåŠŸå¼¹çª—

![æµ‹è¯•æˆåŠŸ](README.assets/image-20260214223119131.png)

æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡äº‘å¹³å°å‘é€å…¶ä½™JSONæ ¼å¼çš„æ¶ˆæ¯ï¼Œå½“å‰ç¨‹åºçš„æ¶ˆæ¯è§£æè§„åˆ™å¦‚ä¸‹ï¼š

| å‘é€çš„æ¶ˆæ¯æ ¼å¼                      | è§£æç»“æœ                     |    çŠ¶æ€    |
| :---------------------------------- | :--------------------------- | :--------: |
| `{ "message": "æ‚¨çš„ä»»ä½•æ¶ˆæ¯å†…å®¹" }` | `æ”¶åˆ°æ¶ˆæ¯ï¼šæ‚¨çš„ä»»ä½•æ¶ˆæ¯å†…å®¹` |  âœ… å¯è§£æ  |
| `{ "status": "connecttestok" }`     | `å°ç¨‹åºè¿æ¥äº‘å¹³å°æµ‹è¯•æˆåŠŸ`   |  âœ… å¯è§£æ  |
| `{ "status": "å…¶ä»–çš„å†…å®¹" }`        | `æ”¶åˆ°æ— æ³•è§£æçš„æ¶ˆæ¯...`      | âŒ æ— æ³•è§£æ |
| `{ "others": "å…¶ä»–çš„ä¸œä¸œ" }`        | `æ”¶åˆ°æ— æ³•è§£æçš„æ¶ˆæ¯...`      | âŒ æ— æ³•è§£æ |

![æ¶ˆæ¯æ¥æ”¶ç¤ºä¾‹](README.assets/image-20260214225412203.png)

---

### 05 ä»£ç å¯é€‰ä¿®æ”¹è¯´æ˜ ğŸ”§

é˜…è¯»è¯¥éƒ¨åˆ†æ‚¨å¯ä»¥å¯¹ç…§å‚è€ƒå‰é¢çš„æ ¸å¿ƒæ–‡ä»¶ç›®å½•æ ‘ã€‚

#### ğŸ“± é¡µé¢çš„åˆ›å»ºä¸ä¿®æ”¹

å¦‚æœä½ æƒ³è¦æ–°å»ºä¸€ä¸ªé¡µé¢ï¼Œå¯ä»¥å³é”® `pages` æ–‡ä»¶å¤¹ï¼Œé€‰æ‹© **æ–°å»º Page**ï¼Œè¿™æ ·ä½ ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­è‡ªåŠ¨åŒ…å«å››ä¸ªæ–‡ä»¶ï¼š

| æ–‡ä»¶    | ä½œç”¨     |
| :------ | :------- |
| `.js`   | é¡µé¢é€»è¾‘ |
| `.wxml` | é¡µé¢ç»“æ„ |
| `.wxss` | é¡µé¢æ ·å¼ |
| `.json` | é¡µé¢é…ç½® |

> âš ï¸ **ç‰¹åˆ«æ³¨æ„**ï¼šæ·»åŠ é¡µé¢åè¦åœ¨ `app.json` çš„ `pages` å­—æ®µæ·»åŠ é¡µé¢è·¯å¾„ï¼Œæ²¡æœ‰æ³¨å†Œçš„ç•Œé¢æ˜¯æ— æ³•ä½¿ç”¨çš„

```json
"pages": [
  "pages/login/login",
  "pages/index/index",
  "pages/message/message"
]
```

**é¡µé¢æ­å»ºé€Ÿæˆæ€è·¯**ï¼ˆä»¥åœ¨ç•Œé¢å±…ä¸­çš„çº¢è‰²ç•Œé¢è·³è½¬æŒ‰é’®ä¸ºä¾‹ï¼‰ï¼š

1. **ç»“æ„æ–‡ä»¶ (`.wxml`)**ï¼šæ”¾ç½®ä¸€ä¸ªæŒ‰é’®ç»„ä»¶
2. **æ ·å¼æ–‡ä»¶ (`.wxss`)**ï¼šå®šä¹‰æŒ‰é’®çš„ä½ç½®ï¼ˆå±…ä¸­ï¼‰å’Œé¢œè‰²ï¼ˆçº¢è‰²ï¼‰
3. **é€»è¾‘æ–‡ä»¶ (`.js`)**ï¼šç¼–å†™æŒ‰ä¸‹æŒ‰é’®è·³è½¬é¡µé¢çš„é€»è¾‘
4. **ç»‘å®š**ï¼šå°†æŒ‰é’®ç»„ä»¶ä¸è·³è½¬é€»è¾‘ç»‘å®š

> ğŸ“š **æ¨èèµ„æº**ï¼šå…·ä½“ä»£ç ç¼–å†™å¯å‚è€ƒ [å¾®ä¿¡å¼€å‘è€…å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)ï¼Œå…¶ä¸­æ¶µç›–å¤§é‡å¯è½»æ¾ç§»æ¤å’Œä½¿ç”¨çš„ç¤ºä¾‹ä»£ç ã€‚

#### ğŸ–¼ï¸ å¤–éƒ¨å›¾æ ‡å’Œå›¾ç‰‡çš„æ·»åŠ 

æœ¬æ¨¡æ¿ä½¿ç”¨ `icon` æ–‡ä»¶å¤¹ä¸“é—¨å­˜æ”¾å°ç¨‹åºæ‰€éœ€è¦çš„å›¾æ ‡ï¼Œç›®å‰è¯¥æ–‡ä»¶å¤¹ä¸‹å·²ç»æ”¾ç½®äº†åº•éƒ¨æ æ‰€éœ€çš„å›¾æ ‡ã€‚ä½¿ç”¨æ—¶å¯ç›´æ¥é€šè¿‡ç›¸å¯¹è·¯å¾„è®¿é—®å›¾æ ‡ï¼š

```json
"tabBar": {
  "list": [
    {
      "iconPath": "icon/connect_black.png",   // é»˜è®¤æ—¶æ˜¾ç¤ºçš„å›¾æ ‡
      "selectedIconPath": "icon/connect_blue.png" // ç‚¹å‡»åæ˜¾ç¤ºçš„å›¾æ ‡
    }
  ]
}
```

åŒç†ï¼Œå¦‚æœéœ€è¦æ·»åŠ å›¾ç‰‡ï¼Œæ‚¨å¯ä»¥åœ¨ `icon` æ–‡ä»¶å¤¹åŒä¸€çº§ç›®å½•æ–°å»º `picture` æ–‡ä»¶å¤¹ä¸“é—¨ç”¨äºå›¾ç‰‡çš„æ”¾ç½®ã€‚

#### âœ‰ï¸ ç‰¹æ®Šæ¶ˆæ¯çš„è§£æ

`message` é¡µé¢æ˜¯ä¸€ä¸ªæ¥æ”¶äº‘å¹³å°æ¶ˆæ¯çš„ç¤ºä¾‹ä»£ç ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•è§£æé€»è¾‘ï¼š

```javascript
processMessagePayload(payload, timestamp) {
  try {
    console.log("è§£ææ¶ˆæ¯payload:", payload);
    const parsedMsg = typeof payload === 'string' ? JSON.parse(payload) : payload;

    // 1. è¿æ¥æµ‹è¯•æˆåŠŸæ¶ˆæ¯ï¼ˆç‰¹æ®Šå¤„ç†ï¼‰
    if (parsedMsg.status === 'connecttestok') {
      this.pushSystemMsg("å°ç¨‹åºè¿æ¥äº‘å¹³å°æµ‹è¯•æˆåŠŸ", timestamp);
      return;
    }

    // 2. æå–å¹¶æ˜¾ç¤ºæ¶ˆæ¯å†…å®¹ï¼ˆmessageå­—æ®µï¼‰
    const msgContent = parsedMsg.message;
    if (msgContent) {
      this.pushMsg(`æ”¶åˆ°æ¶ˆæ¯: ${msgContent}`, timestamp, {
        type: 'parsed',
        original: parsedMsg
      });
      return;
    }

    // ğŸ‘‡ åœ¨è¿™é‡Œæ‰©å±•æ‚¨çš„è‡ªå®šä¹‰æ¶ˆæ¯è§£æé€»è¾‘ ğŸ‘‡
    // ç¤ºä¾‹ï¼šè§£ææ¸©åº¦æ•°æ®
    // if (parsedMsg.temperature) {
    //   this.pushMsg(`ğŸŒ¡ï¸ å½“å‰æ¸©åº¦: ${parsedMsg.temperature}Â°C`, timestamp);
    //   return;
    // }

    // 3. æ— æ³•è§£æçš„æ¶ˆæ¯
    this.pushMsg(`æ”¶åˆ°æ— æ³•è§£æçš„æ¶ˆæ¯: ${JSON.stringify(parsedMsg)}`, timestamp, {
      type: 'unparsed',
      original: parsedMsg
    });

  } catch (error) {
    console.error("æ¶ˆæ¯è§£æé”™è¯¯:", error);
    this.pushMsg(`æ”¶åˆ°æ— æ³•è§£æçš„æ¶ˆæ¯: ${payload}`, timestamp, { type: 'unparsed' });
  }
},
```

---

### ğŸ“œ å¼€æºè®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT è®¸å¯è¯** å¼€æºï¼Œéšä¾¿ç”¨ï¼Œéšä¾¿ç©~

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæˆ–æœ‰ä»»ä½•æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿è”ç³»ä½œè€…ğŸ‰

